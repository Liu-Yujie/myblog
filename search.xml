<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>photoprism 部署</title>
      <link href="/2024/02/01/photoprism-deploy/"/>
      <url>/2024/02/01/photoprism-deploy/</url>
      
        <content type="html"><![CDATA[<p><strong>PhotoPrism</strong> 是一个开源的照片管理工具，是一款 AI 驱动的应用程序，用于浏览、组织和分享您的照片集，可以在本地搭建Server端，可以很好的替代Google相册，相关资料：</p><p><strong>GitHub地址：</strong><a href="https://link.zhihu.com/?target=https://github.com/photoprism/photoprism/">https://github.com/photoprism/photoprism/</a></p><p><strong>官网地址：</strong><a href="https://link.zhihu.com/?target=https://docs.photoprism.org/">https://docs.photoprism.org/</a></p><p><strong>官方Demo</strong>：<a href="https://demo-zh.photoprism.app/library/browse">https://demo-zh.photoprism.app/library/browse</a></p><p><img src="https://docs.photoprism.app/img/preview.jpg" alt="Screenshot"></p><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p><strong>你拥有一台能够运行docker，并且已经安装了docker、docker-compose，并且运行内存最好 &gt;= 4GB的设备</strong></p><h2 id="创建文件docker-compose-yml"><a href="#创建文件docker-compose-yml" class="headerlink" title="创建文件docker-compose.yml"></a>创建文件<code>docker-compose.yml</code></h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example Docker Compose config file for PhotoPrism (Linux / AMD64)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span></span></span><br><span class="line"><span class="comment"># - Running PhotoPrism on a server with less than 4 GB of swap space or setting a memory/swap limit can cause unexpected</span></span><br><span class="line"><span class="comment">#   restarts (&quot;crashes&quot;), for example, when the indexer temporarily needs more memory to process large files.</span></span><br><span class="line"><span class="comment"># - If you install PhotoPrism on a public server outside your home network, please always run it behind a secure</span></span><br><span class="line"><span class="comment">#   HTTPS reverse proxy such as Traefik or Caddy. Your files and passwords will otherwise be transmitted</span></span><br><span class="line"><span class="comment">#   in clear text and can be intercepted by anyone, including your provider, hackers, and governments:</span></span><br><span class="line"><span class="comment">#   https://docs.photoprism.app/getting-started/proxies/traefik/</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Setup Guides:</span></span><br><span class="line"><span class="comment"># - https://docs.photoprism.app/getting-started/docker-compose/</span></span><br><span class="line"><span class="comment"># - https://docs.photoprism.app/getting-started/raspberry-pi/</span></span><br><span class="line"><span class="comment"># - https://www.photoprism.app/kb/activation</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Troubleshooting Checklists:</span></span><br><span class="line"><span class="comment"># - https://docs.photoprism.app/getting-started/troubleshooting/</span></span><br><span class="line"><span class="comment"># - https://docs.photoprism.app/getting-started/troubleshooting/docker/</span></span><br><span class="line"><span class="comment"># - https://docs.photoprism.app/getting-started/troubleshooting/mariadb/</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># CLI Commands:</span></span><br><span class="line"><span class="comment"># - https://docs.photoprism.app/getting-started/docker-compose/#command-line-interface</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># All commands may have to be prefixed with &quot;sudo&quot; when not running as root.</span></span><br><span class="line"><span class="comment"># This will point the home directory shortcut ~ to /root in volume mounts.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">photoprism:</span></span><br><span class="line">    <span class="comment">## Use photoprism/photoprism:preview for testing preview builds:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">photoprism/photoprism:latest</span></span><br><span class="line">    <span class="comment">## Don&#x27;t enable automatic restarts until PhotoPrism has been properly configured and tested!</span></span><br><span class="line">    <span class="comment">## If the service gets stuck in a restart loop, this points to a memory, filesystem, network, or database issue:</span></span><br><span class="line">    <span class="comment">## https://docs.photoprism.app/getting-started/troubleshooting/#fatal-server-errors</span></span><br><span class="line">    <span class="comment"># restart: unless-stopped</span></span><br><span class="line">    <span class="attr">stop_grace_period:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="attr">security_opt:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">seccomp:unconfined</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">apparmor:unconfined</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="comment">## Web server port mapping in the format &quot;Host:Container&quot;. To use a different port, change the host port</span></span><br><span class="line">      <span class="comment">## on the left-hand side and keep the container port, e.g. &quot;80:2342&quot; (for HTTP) or &quot;443:2342 (for HTTPS):</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;2342:2342&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_ADMIN_USER:</span> <span class="string">&quot;admin&quot;</span>                 <span class="comment"># admin login username</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_ADMIN_PASSWORD:</span> <span class="string">&quot;initial@password.&quot;</span>          <span class="comment"># initial admin password (8-72 characters)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_AUTH_MODE:</span> <span class="string">&quot;password&quot;</span>               <span class="comment"># authentication mode (public, password)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_SITE_URL:</span> <span class="string">&quot;http://localhost:2342/&quot;</span>  <span class="comment"># server URL in the format &quot;http(s)://domain.name(:port)/(path)&quot;</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_TLS:</span> <span class="string">&quot;false&quot;</span>                <span class="comment"># disables HTTPS/TLS even if the site URL starts with https:// and a certificate is available</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DEFAULT_TLS:</span> <span class="string">&quot;true&quot;</span>                 <span class="comment"># defaults to a self-signed HTTPS/TLS certificate if no other certificate is available</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_ORIGINALS_LIMIT:</span> <span class="number">5000</span>               <span class="comment"># file size limit for originals in MB (increase for high-res video)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_HTTP_COMPRESSION:</span> <span class="string">&quot;gzip&quot;</span>            <span class="comment"># improves transfer speed and bandwidth utilization (none or gzip)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_LOG_LEVEL:</span> <span class="string">&quot;info&quot;</span>                   <span class="comment"># log level: trace, debug, info, warning, error, fatal, or panic</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_READONLY:</span> <span class="string">&quot;false&quot;</span>                   <span class="comment"># do not modify originals directory (reduced functionality)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_EXPERIMENTAL:</span> <span class="string">&quot;false&quot;</span>               <span class="comment"># enables experimental features</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_CHOWN:</span> <span class="string">&quot;false&quot;</span>              <span class="comment"># disables updating storage permissions via chmod and chown on startup</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_WEBDAV:</span> <span class="string">&quot;false&quot;</span>             <span class="comment"># disables built-in WebDAV server</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_SETTINGS:</span> <span class="string">&quot;false&quot;</span>           <span class="comment"># disables settings UI and API</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_TENSORFLOW:</span> <span class="string">&quot;false&quot;</span>         <span class="comment"># disables all features depending on TensorFlow</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_FACES:</span> <span class="string">&quot;false&quot;</span>              <span class="comment"># disables face detection and recognition (requires TensorFlow)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_CLASSIFICATION:</span> <span class="string">&quot;false&quot;</span>     <span class="comment"># disables image classification (requires TensorFlow)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_VECTORS:</span> <span class="string">&quot;false&quot;</span>            <span class="comment"># disables vector graphics support</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DISABLE_RAW:</span> <span class="string">&quot;false&quot;</span>                <span class="comment"># disables indexing and conversion of RAW images</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_RAW_PRESETS:</span> <span class="string">&quot;false&quot;</span>                <span class="comment"># enables applying user presets when converting RAW images (reduces performance)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_JPEG_QUALITY:</span> <span class="number">85</span>                    <span class="comment"># a higher value increases the quality and file size of JPEG images and thumbnails (25-100)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DETECT_NSFW:</span> <span class="string">&quot;false&quot;</span>                <span class="comment"># automatically flags photos as private that MAY be offensive (requires TensorFlow)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_UPLOAD_NSFW:</span> <span class="string">&quot;true&quot;</span>                 <span class="comment"># allows uploads that MAY be offensive (no effect without TensorFlow)</span></span><br><span class="line">      <span class="comment"># PHOTOPRISM_DATABASE_DRIVER: &quot;sqlite&quot;         # SQLite is an embedded database that doesn&#x27;t require a server</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DATABASE_DRIVER:</span> <span class="string">&quot;mysql&quot;</span>            <span class="comment"># use MariaDB 10.5+ or MySQL 8+ instead of SQLite for improved performance</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DATABASE_SERVER:</span> <span class="string">&quot;mariadb:3306&quot;</span>     <span class="comment"># MariaDB or MySQL database server (hostname:port)</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DATABASE_NAME:</span> <span class="string">&quot;photoprism&quot;</span>         <span class="comment"># MariaDB or MySQL database schema name</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DATABASE_USER:</span> <span class="string">&quot;photoprism&quot;</span>         <span class="comment"># MariaDB or MySQL database user name</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_DATABASE_PASSWORD:</span> <span class="string">&quot;xNLL4XGwhtrxk1kd&quot;</span>       <span class="comment"># MariaDB or MySQL database user password</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_SITE_CAPTION:</span> <span class="string">&quot;AI-Powered Photos App of Mr.Liu&quot;</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_SITE_DESCRIPTION:</span> <span class="string">&quot;funny pic&quot;</span>                <span class="comment"># meta site description</span></span><br><span class="line">      <span class="attr">PHOTOPRISM_SITE_AUTHOR:</span> <span class="string">&quot;Yujie Liu&quot;</span>                     <span class="comment"># meta site author</span></span><br><span class="line">      <span class="comment">## Video Transcoding (https://docs.photoprism.app/getting-started/advanced/transcoding/):</span></span><br><span class="line">      <span class="comment"># PHOTOPRISM_FFMPEG_ENCODER: &quot;software&quot;        # H.264/AVC encoder (software, intel, nvidia, apple, raspberry, or vaapi)</span></span><br><span class="line">      <span class="comment"># PHOTOPRISM_FFMPEG_SIZE: &quot;1920&quot;               # video size limit in pixels (720-7680) (default: 3840)</span></span><br><span class="line">      <span class="comment"># PHOTOPRISM_FFMPEG_BITRATE: &quot;32&quot;              # video bitrate limit in Mbit/s (default: 50)</span></span><br><span class="line">      <span class="comment">## Run/install on first startup (options: update https gpu tensorflow davfs clitools clean):</span></span><br><span class="line">      <span class="comment"># PHOTOPRISM_INIT: &quot;https gpu tensorflow&quot;</span></span><br><span class="line">      <span class="comment">## Run as a non-root user after initialization (supported: 0, 33, 50-99, 500-600, and 900-1200):</span></span><br><span class="line">      <span class="comment"># PHOTOPRISM_UID: 1000</span></span><br><span class="line">      <span class="comment"># PHOTOPRISM_GID: 1000</span></span><br><span class="line">      <span class="comment"># PHOTOPRISM_UMASK: 0000</span></span><br><span class="line">    <span class="comment">## Start as non-root user before initialization (supported: 0, 33, 50-99, 500-600, and 900-1200):</span></span><br><span class="line">    <span class="comment"># user: &quot;1000:1000&quot;</span></span><br><span class="line">    <span class="comment">## Share hardware devices with FFmpeg and TensorFlow (optional):</span></span><br><span class="line">    <span class="comment"># devices:</span></span><br><span class="line">    <span class="comment">#  - &quot;/dev/dri:/dev/dri&quot;                         # Intel QSV</span></span><br><span class="line">    <span class="comment">#  - &quot;/dev/nvidia0:/dev/nvidia0&quot;                 # Nvidia CUDA</span></span><br><span class="line">    <span class="comment">#  - &quot;/dev/nvidiactl:/dev/nvidiactl&quot;</span></span><br><span class="line">    <span class="comment">#  - &quot;/dev/nvidia-modeset:/dev/nvidia-modeset&quot;</span></span><br><span class="line">    <span class="comment">#  - &quot;/dev/nvidia-nvswitchctl:/dev/nvidia-nvswitchctl&quot;</span></span><br><span class="line">    <span class="comment">#  - &quot;/dev/nvidia-uvm:/dev/nvidia-uvm&quot;</span></span><br><span class="line">    <span class="comment">#  - &quot;/dev/nvidia-uvm-tools:/dev/nvidia-uvm-tools&quot;</span></span><br><span class="line">    <span class="comment">#  - &quot;/dev/video11:/dev/video11&quot;                 # Video4Linux Video Encode Device (h264_v4l2m2m)</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">&quot;/photoprism&quot;</span> <span class="comment"># do not change or remove</span></span><br><span class="line">    <span class="comment">## Storage Folders: &quot;~&quot; is a shortcut for your home directory, &quot;.&quot; for the current directory</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="comment"># &quot;/host/folder:/photoprism/folder&quot;                # Example</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./photo/originals:/photoprism/originals&quot;</span>               <span class="comment"># Original media files (DO NOT REMOVE)</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./photo/originals/family:/photoprism/originals/family&quot;</span> <span class="comment"># *Additional* media folders can be mounted like this</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./photo/import:/photoprism/import&quot;</span>                  <span class="comment"># *Optional* base folder from which files can be imported to originals</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./storage:/photoprism/storage&quot;</span>                  <span class="comment"># *Writable* storage folder for cache, database, and sidecar files (DO NOT REMOVE)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">## Database Server (recommended)</span></span><br><span class="line">  <span class="comment">## see https://docs.photoprism.app/getting-started/faq/#should-i-use-sqlite-mariadb-or-mysql</span></span><br><span class="line">  <span class="attr">mariadb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mariadb:11</span></span><br><span class="line">    <span class="comment">## If MariaDB gets stuck in a restart loop, this points to a memory or filesystem issue:</span></span><br><span class="line">    <span class="comment">## https://docs.photoprism.app/getting-started/troubleshooting/#fatal-server-errors</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">stop_grace_period:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">security_opt:</span> <span class="comment"># see https://github.com/MariaDB/mariadb-docker/issues/434#issuecomment-1136151239</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">seccomp:unconfined</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">apparmor:unconfined</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--innodb-buffer-pool-size=512M</span> <span class="string">--transaction-isolation=READ-COMMITTED</span> <span class="string">--character-set-server=utf8mb4</span> <span class="string">--collation-server=utf8mb4_unicode_ci</span> <span class="string">--max-connections=512</span> <span class="string">--innodb-rollback-on-timeout=OFF</span> <span class="string">--innodb-lock-wait-timeout=120</span></span><br><span class="line">    <span class="comment">## Never store database files on an unreliable device such as a USB flash drive, an SD card, or a shared network folder:</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./database:/var/lib/mysql&quot;</span> <span class="comment"># DO NOT REMOVE</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MARIADB_AUTO_UPGRADE:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">      <span class="attr">MARIADB_INITDB_SKIP_TZINFO:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">      <span class="attr">MARIADB_DATABASE:</span> <span class="string">&quot;photoprism&quot;</span></span><br><span class="line">      <span class="attr">MARIADB_USER:</span> <span class="string">&quot;photoprism&quot;</span></span><br><span class="line">      <span class="attr">MARIADB_PASSWORD:</span> <span class="string">&quot;xNLL4XGwhtrxk1kd&quot;</span></span><br><span class="line">      <span class="attr">MARIADB_ROOT_PASSWORD:</span> <span class="string">&quot;xNLL4XGwhtrxk1kd&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">## Watchtower upgrades services automatically (optional)</span></span><br><span class="line">  <span class="comment">## see https://docs.photoprism.app/getting-started/updates/#watchtower</span></span><br><span class="line">  <span class="comment">## activate via &quot;COMPOSE_PROFILES=update docker compose up -d&quot;</span></span><br><span class="line">  <span class="attr">watchtower:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">containrrr/watchtower</span></span><br><span class="line">    <span class="attr">profiles:</span> [<span class="string">&quot;update&quot;</span>]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">WATCHTOWER_CLEANUP:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">      <span class="attr">WATCHTOWER_POLL_INTERVAL:</span> <span class="number">7200</span> <span class="comment"># checks for updates every two hours</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;~/.docker/config.json:/config.json&quot;</span> <span class="comment"># optional, for authentication if you have a Docker Hub account</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>在文件路径下执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose up -d</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(base) [~/Documents/project/photoprism]$ docker-compose up -d</span><br><span class="line">Creating network <span class="string">&quot;photoprism_default&quot;</span> with the default driver</span><br><span class="line">Pulling mariadb (mariadb:11)...</span><br><span class="line">11: Pulling from library/mariadb</span><br><span class="line">ce9ebea987c2: Pull complete</span><br><span class="line">43435310a133: Pull complete</span><br><span class="line">ef59ed3a45af: Pull complete</span><br><span class="line">7aab0cd96694: Pull complete</span><br><span class="line">903de9cdbd58: Pull complete</span><br><span class="line">396fe381300e: Pull complete</span><br><span class="line">9e79b3e672fb: Pull complete</span><br><span class="line">e403bc64b980: Pull complete</span><br><span class="line">Digest: sha256:eb6a2d34367b662a6e9c92e8cd112bbadf03ad4627f8eeb8d19f480f8da87fa6</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mariadb:11</span><br><span class="line">Pulling photoprism (photoprism/photoprism:latest)...</span><br><span class="line">latest: Pulling from photoprism/photoprism</span><br><span class="line">f906b88252ef: Pull complete</span><br><span class="line">4cd4d808ccce: Pull complete</span><br><span class="line">f53ac1166782: Pull complete</span><br><span class="line">4f4fb700ef54: Pull complete</span><br><span class="line">cfc84efec0ed: Pull complete</span><br><span class="line">f5c4775bbd60: Pull complete</span><br><span class="line">43ea8d2031e7: Pull complete</span><br><span class="line">Digest: sha256:cf45026f3381b13cc638ed556d1f717340267d1a832794380f49998fd3a899c8</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> photoprism/photoprism:latest</span><br><span class="line">Creating photoprism_mariadb_1 ... <span class="keyword">done</span></span><br><span class="line">Creating photoprism_photoprism_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>docker-compose 相关命令</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker container ls  # 查看容器信息，主要看它的名称 NAMES，方便进入容器内部</span><br><span class="line">docker exec -it nextcloud_app_1 bash  # 进入容易内部，nextcloud_app_1 是容器的名称，上面那个命令查出来的</span><br><span class="line">exit # 进入容器内部后，要退出的话 输入 exit 即可</span><br><span class="line">docker ps -a  # 查看所有 docker 容器</span><br><span class="line">docker ps  # 查看正在运行 docker 容器</span><br><span class="line">docker stop 容器名称或者ID  # 停止正在运行的容器</span><br><span class="line">docker rm 容器名称或者ID  #移除容器，移除前先停止容器</span><br></pre></td></tr></table></figure></blockquote><h2 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h2><p><a href="http://localhost:2342/">http://localhost:2342/</a></p><h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><p><a href="https://github.com/photoprism/photoprism">PhotoPrism: Browse Your Life in Pictures</a></p><p><a href="https://docs.photoprism.app/">官方使用手册</a></p><p><a href="https://blog.csdn.net/qq_36133747/article/details/131310407">开源照片管理项目测评</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Raspberry Pi </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 树莓派 </tag>
            
            <tag> Raspberry Pi </tag>
            
            <tag> iCloud </tag>
            
            <tag> photo </tag>
            
            <tag> 同步 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>icloudpd 部署</title>
      <link href="/2024/02/01/icloudpd-deploy/"/>
      <url>/2024/02/01/icloudpd-deploy/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这是一个用于 iCloud 照片下载的Alpine Linux Docker 容器。我用它来将我家中所有iCloud的照片流同步回我的服务器。然后搭配photoprism 即可完美搭建自己的家庭相册，非常的nice！</p><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p><strong>你拥有一台能够运行docker，并且已经安装了docker、docker-compose的设备</strong></p><h2 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /www/server/icloudpd</span><br><span class="line">sudo chmod -R 755 /www/server/icloudpd</span><br></pre></td></tr></table></figure><h2 id="创建配置文件user1-env"><a href="#创建配置文件user1-env" class="headerlink" title="创建配置文件user1.env"></a>创建配置文件user1.env</h2><p>一个用户创建一个配置，如有第二个用户则创建 第二个配置文件<strong>user2.env</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># iCloudPD environment variables</span><br><span class="line"># Variables with values beneath are showing the defaults used by the script if not specified</span><br><span class="line"></span><br><span class="line"># User and group details for account</span><br><span class="line">user=user1</span><br><span class="line">user_id=1000</span><br><span class="line">#group=group</span><br><span class="line">group_id=1000</span><br><span class="line"></span><br><span class="line">## Apple iCloud Photo Downloader</span><br><span class="line"># Apple ID credentials 填上自己的apple id</span><br><span class="line">apple_id=xxxx@xxxx.com</span><br><span class="line"></span><br><span class="line"># Authentication type 2FA or Web</span><br><span class="line">authentication_type=2FA</span><br><span class="line"></span><br><span class="line"># Folder structure for downloaded files</span><br><span class="line">folder_structure=&#123;:%Y/%m&#125;</span><br><span class="line"></span><br><span class="line"># Permissions for directories and files</span><br><span class="line">directory_permissions=755</span><br><span class="line">file_permissions=755</span><br><span class="line"></span><br><span class="line"># Creates a JPEG copy of any downloaded HEIC files (set empty to disable)</span><br><span class="line">#convert_heic_to_jpeg=</span><br><span class="line"></span><br><span class="line"># Delete JPEG files if associated HEIC file is removed (set empty to disable)</span><br><span class="line">#delete_heic_jpegs=</span><br><span class="line"></span><br><span class="line"># Additional command line options to pass to iCloud Photo Downloader eg: --auto-delete --set-exif-datetime</span><br><span class="line">#command_line_options=</span><br><span class="line"></span><br><span class="line"># Syncronisation interval. 21600=6hr, 43200=12hr, 86400=24hr</span><br><span class="line">#synchronisation_interval=86400</span><br><span class="line"></span><br><span class="line"># Set the number of days before 2FA expires to start ending notifications</span><br><span class="line">#notification_days=80</span><br><span class="line"></span><br><span class="line"># Set notification type to Prowl, Pushbullet or Telegram</span><br><span class="line">#notification_type=</span><br><span class="line"></span><br><span class="line"># The API key for Prowl, Pushbullet and Telegram notifications</span><br><span class="line">#prowl_api_key=</span><br><span class="line">#pushbullet_api_key=</span><br><span class="line">#telegram_token=</span><br><span class="line">#telegram_chat_id=</span><br><span class="line"></span><br><span class="line">icloud_china=true</span><br><span class="line">auth_china=true</span><br></pre></td></tr></table></figure><h2 id="创建docker-compose-yml"><a href="#创建docker-compose-yml" class="headerlink" title="创建docker-compose.yml"></a>创建docker-compose.yml</h2><p>如果只有一个需要同步，则删掉下面</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   <span class="attr">icloudpd_user1:</span></span><br><span class="line">      <span class="attr">hostname:</span> <span class="string">icloudpd_user1</span></span><br><span class="line">      <span class="attr">environment:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">boredazfcuk/icloudpd</span></span><br><span class="line">      <span class="attr">healthcheck:</span></span><br><span class="line">         <span class="attr">test:</span> <span class="string">/usr/local/bin/healthcheck.sh</span></span><br><span class="line">         <span class="attr">start_period:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">./icloudpd_user1_config:/config</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">/media/saber/saber/nextcloud/data/iCould-yujie/:/home/user1/iCloud/</span></span><br><span class="line">      <span class="attr">env_file:</span> </span><br><span class="line">         <span class="bullet">-</span> <span class="string">./user1.env</span></span><br><span class="line">   <span class="comment"># 第二个用户的配置，不需要则删掉下面</span></span><br><span class="line">   <span class="attr">icloudpd_user2:</span></span><br><span class="line">      <span class="attr">hostname:</span> <span class="string">icloudpd_user2</span></span><br><span class="line">      <span class="attr">environment:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">boredazfcuk/icloudpd</span></span><br><span class="line">      <span class="attr">healthcheck:</span></span><br><span class="line">         <span class="attr">test:</span> <span class="string">/usr/local/bin/healthcheck.sh</span></span><br><span class="line">         <span class="attr">start_period:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">./icloudpd_user2_config:/config</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">/media/saber/saber/nextcloud/data/iCould-enya/:/home/user2/iCloud/</span></span><br><span class="line">      <span class="attr">env_file:</span> </span><br><span class="line">         <span class="bullet">-</span> <span class="string">./user2.env</span></span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose up -d</span><br></pre></td></tr></table></figure><blockquote><p><strong>docker-compose 相关命令</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker container ls  # 查看容器信息，主要看它的名称 NAMES，方便进入容器内部</span><br><span class="line">docker exec -it nextcloud_app_1 bash  # 进入容易内部，nextcloud_app_1 是容器的名称，上面那个命令查出来的</span><br><span class="line">exit # 进入容器内部后，要退出的话 输入 exit 即可</span><br><span class="line">docker ps -a  # 查看所有 docker 容器</span><br><span class="line">docker ps  # 查看正在运行 docker 容器</span><br><span class="line">docker stop 容器名称或者ID  # 停止正在运行的容器</span><br><span class="line">docker rm 容器名称或者ID  #移除容器，移除前先停止容器</span><br></pre></td></tr></table></figure></blockquote><h2 id="进入容器配置登录"><a href="#进入容器配置登录" class="headerlink" title="进入容器配置登录"></a>进入容器配置登录</h2><p><code>icloudpd-icloudpd_user1-1</code>为容器名，根据实际情况替换</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进入容器</span></span><br><span class="line">sudo docker exec -it icloudpd-icloudpd_user1-1 sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化命令</span></span><br><span class="line">/usr/local/bin/sync-icloud.sh --Initialize</span><br></pre></td></tr></table></figure><p>以下为进入容器后的操作过程</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">saber@raspberrypi5:/www/server/icloudpd $ sudo docker <span class="built_in">exec</span> -it icloudpd-icloudpd_user1-1 sh</span><br><span class="line">/ <span class="comment"># cat /config/icloudpd.conf </span></span><br><span class="line">agentid=</span><br><span class="line">albums_with_dates=<span class="literal">false</span></span><br><span class="line">apple_id=yujie.liu6@outlook.com</span><br><span class="line">auth_china=<span class="literal">true</span></span><br><span class="line">authentication_type=MFA</span><br><span class="line">auto_delete=<span class="literal">false</span></span><br><span class="line">bark_device_key=</span><br><span class="line">bark_server=</span><br><span class="line">content_source_url=</span><br><span class="line">convert_heic_to_jpeg=<span class="literal">false</span></span><br><span class="line">debug_logging=<span class="literal">false</span></span><br><span class="line">delete_accompanying=<span class="literal">false</span></span><br><span class="line">delete_after_download=<span class="literal">false</span></span><br><span class="line">delete_notifications=<span class="literal">true</span></span><br><span class="line">dingtalk_token=</span><br><span class="line">directory_permissions=755</span><br><span class="line">discord_id=</span><br><span class="line">discord_token=</span><br><span class="line">download_notifications=<span class="literal">true</span></span><br><span class="line">download_path=</span><br><span class="line">file_permissions=755</span><br><span class="line">folder_structure=&#123;:%Y/%m/%d&#125;</span><br><span class="line">gotify_app_token=</span><br><span class="line">gotify_https=</span><br><span class="line">gotify_server_url=</span><br><span class="line">group=group</span><br><span class="line">group_id=1000</span><br><span class="line">icloud_china=<span class="literal">true</span></span><br><span class="line">iyuu_token=</span><br><span class="line">jpeg_path=</span><br><span class="line">jpeg_quality=90</span><br><span class="line">libraries_with_dates=<span class="literal">false</span></span><br><span class="line">media_id_delete=</span><br><span class="line">media_id_download=</span><br><span class="line">media_id_expiration=</span><br><span class="line">media_id_startup=</span><br><span class="line">media_id_warning=</span><br><span class="line">nextcloud_delete=<span class="literal">false</span></span><br><span class="line">nextcloud_password=</span><br><span class="line">nextcloud_upload=<span class="literal">false</span></span><br><span class="line">nextcloud_url=</span><br><span class="line">nextcloud_username=</span><br><span class="line">notification_days=7</span><br><span class="line">notification_type=</span><br><span class="line">photo_album=</span><br><span class="line">photo_library=</span><br><span class="line">photo_size=original</span><br><span class="line">prowl_api_key=</span><br><span class="line">pushover_sound=</span><br><span class="line">pushover_token=</span><br><span class="line">pushover_user=</span><br><span class="line">recent_only=</span><br><span class="line">set_exif_datetime=<span class="literal">false</span></span><br><span class="line">single_pass=<span class="literal">false</span></span><br><span class="line">skip_album=</span><br><span class="line">skip_check=<span class="literal">false</span></span><br><span class="line">skip_download=<span class="literal">false</span></span><br><span class="line">skip_library=</span><br><span class="line">skip_live_photos=<span class="literal">false</span></span><br><span class="line">skip_videos=<span class="literal">false</span></span><br><span class="line">startup_notification=<span class="literal">true</span></span><br><span class="line">synchronisation_delay=0</span><br><span class="line">synchronisation_interval=86400</span><br><span class="line">synology_ignore_path=<span class="literal">false</span></span><br><span class="line">telegram_chat_id=</span><br><span class="line">telegram_polling=<span class="literal">true</span></span><br><span class="line">telegram_server=</span><br><span class="line">telegram_silent_file_notifications=</span><br><span class="line">telegram_token=</span><br><span class="line">touser=</span><br><span class="line">trigger_nextlcoudcli_synchronisation=</span><br><span class="line">until_found=</span><br><span class="line">user_id=1000</span><br><span class="line">webhook_https=<span class="literal">false</span></span><br><span class="line">webhook_id=</span><br><span class="line">webhook_path=/api/webhook/</span><br><span class="line">webhook_port=8123</span><br><span class="line">webhook_server=</span><br><span class="line">wecom_id=</span><br><span class="line">wecom_proxy=</span><br><span class="line">wecom_secret=</span><br><span class="line">/ <span class="comment"># /usr/local/bin/sync-icloud.sh --Initialize</span></span><br><span class="line"></span><br><span class="line">2024-01-27 14:31:10 INFO     ***** boredazfcuk/icloudpd container <span class="keyword">for</span> icloud_photo_downloader v1.0.716 started *****</span><br><span class="line">2024-01-27 14:31:10 INFO     ***** For support, please go here: https://github.com/boredazfcuk/docker-icloudpd *****</span><br><span class="line">2024-01-27 14:31:10 INFO     Alpine Linux 3.19.0</span><br><span class="line">2024-01-27 14:31:10 INFO     Python version: 3.11.6</span><br><span class="line">2024-01-27 14:31:10 INFO     Loading configuration from: /config/icloudpd.conf</span><br><span class="line">2024-01-27 14:31:30 INFO     Apple ID: yujie.liu6@outlook.com</span><br><span class="line">2024-01-27 14:31:30 INFO     Authentication Type: MFA</span><br><span class="line">2024-01-27 14:31:30 INFO     Cookie path: /config/yujieliu6outlookcom</span><br><span class="line">2024-01-27 14:31:30 INFO     Cookie expiry notification period: 7</span><br><span class="line">2024-01-27 14:31:30 INFO     Download destination directory: /home/user/iCloud</span><br><span class="line">2024-01-27 14:31:30 INFO     Folder structure: &#123;:%Y/%m/%d&#125;</span><br><span class="line">2024-01-27 14:31:30 INFO     Synchronisation interval: 86400</span><br><span class="line">2024-01-27 14:31:30 INFO     Synchronisation delay (minutes): 0</span><br><span class="line">2024-01-27 14:31:30 INFO     Set EXIF date/time: <span class="literal">false</span></span><br><span class="line">2024-01-27 14:31:30 INFO     Auto delete: <span class="literal">false</span></span><br><span class="line">2024-01-27 14:31:30 INFO     Delete after download: <span class="literal">false</span></span><br><span class="line">2024-01-27 14:31:30 INFO     Photo size: original</span><br><span class="line">2024-01-27 14:31:30 INFO     Single pass mode: <span class="literal">false</span></span><br><span class="line">2024-01-27 14:31:30 INFO     Skip download check: <span class="literal">false</span></span><br><span class="line">2024-01-27 14:31:30 INFO     Skip live photos: <span class="literal">false</span></span><br><span class="line">2024-01-27 14:31:30 INFO     Number of most recently added photos to download: Download All Photos</span><br><span class="line">2024-01-27 14:31:30 INFO     Downloading photos from: Download All Photos</span><br><span class="line">2024-01-27 14:31:30 INFO     Stop downloading when prexisiting files count is: Download All Photos</span><br><span class="line">2024-01-27 14:31:30 INFO     Live photo size: original</span><br><span class="line">2024-01-27 14:31:30 INFO     Skip videos: <span class="literal">false</span></span><br><span class="line">2024-01-27 14:31:30 INFO     Convert HEIC to JPEG: <span class="literal">false</span></span><br><span class="line">2024-01-27 14:31:30 INFO     Downloading from: icloud.com.cn</span><br><span class="line">2024-01-27 14:31:30 INFO     Authentication domain: cn</span><br><span class="line">2024-01-27 14:31:30 INFO     Ignore Synology extended attribute directories: Disabled</span><br><span class="line">2024-01-27 14:31:32 INFO     Script launch parameters: --Initialize</span><br><span class="line">Enter iCloud password <span class="keyword">for</span> yujie.liu6@outlook.com: </span><br><span class="line">Save password <span class="keyword">in</span> keyring? [y/N]: y</span><br><span class="line"></span><br><span class="line">Two-step authentication required. </span><br><span class="line">Please enter validation code</span><br><span class="line">(string) --&gt; 006568</span><br><span class="line"></span><br><span class="line">2024-01-27 14:32:09 INFO     Starting container initialisation</span><br><span class="line">Please enter two-factor authentication code: 505334</span><br><span class="line">2024-01-27 14:32:24 WARNING  Failed to parse response with JSON mimetype</span><br><span class="line">2024-01-27 14:32:31 INFO     Multifactor authentication cookie generated. Sync should now be successful</span><br><span class="line">2024-01-27 14:32:31 INFO     Container initialisation complete</span><br></pre></td></tr></table></figure><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://github.com/boredazfcuk">boredazfcuk</a>/<strong><a href="https://github.com/boredazfcuk/docker-icloudpd">docker-icloudpd</a></strong></p><p><a href="https://github.com/boredazfcuk/docker-icloudpd/issues/309">https://github.com/boredazfcuk/docker-icloudpd/issues/309</a></p><p><a href="https://dockerdocs.cn/compose/environment-variables/">https://dockerdocs.cn/compose/environment-variables/</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Raspberry Pi </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 树莓派 </tag>
            
            <tag> Raspberry Pi </tag>
            
            <tag> iCloud </tag>
            
            <tag> photo </tag>
            
            <tag> 同步 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/01/06/hello-world/"/>
      <url>/2022/01/06/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>更换电脑继续写blog</title>
      <link href="/2021/06/21/%E6%9B%B4%E6%8D%A2%E7%94%B5%E8%84%91%E6%93%8D%E4%BD%9C/"/>
      <url>/2021/06/21/%E6%9B%B4%E6%8D%A2%E7%94%B5%E8%84%91%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="新建分支"><a href="#新建分支" class="headerlink" title="新建分支"></a>新建分支</h2><p>先在github上新建一个hexo分支，如图：</p><p><img src="/2021/06/21/%E6%9B%B4%E6%8D%A2%E7%94%B5%E8%84%91%E6%93%8D%E4%BD%9C/image-20210621102628680.png" alt="image-20210621102628680"></p><p>然后在这个仓库的settings中，选择默认分支为hexo分支（这样每次同步的时候就不用指定分支，比较方便）。</p><p><img src="/2021/06/21/%E6%9B%B4%E6%8D%A2%E7%94%B5%E8%84%91%E6%93%8D%E4%BD%9C/image-20210621102718393.png" alt="image-20210621102718393"></p><p>然后在本地的任意目录下，打开git bash，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:yuiej/yuiej.GitHub.io.git</span><br></pre></td></tr></table></figure><p>接下来在克隆到本地的ZJUFangzh.github.io中，把除了.git 文件夹外的所有文件都删掉</p><p>把之前我们写的博客源文件全部复制过来，除了.deploy_git。复制过来的源文件应该有一个.gitignore，如果没有的话，自己新建一个，在里面写上如下，表示这些类型文件不需要git：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">.DS_Store</span></span><br><span class="line"><span class="attr">Thumbs.db</span></span><br><span class="line"><span class="attr">db.json</span></span><br><span class="line"><span class="attr">*.log</span></span><br><span class="line"><span class="attr">node_modules/</span></span><br><span class="line"><span class="attr">public/</span></span><br><span class="line"><span class="attr">.deploy*/</span></span><br></pre></td></tr></table></figure><blockquote><p>注意，如果你之前克隆过theme中的主题文件，那么应该把主题文件中的.git文件夹删掉，因为git不能嵌套上传，最好是显示隐藏文件，检查一下有没有，否则上传的时候会出错，导致你的主题文件无法上传，这样你的配置在别的电脑上就用不了了。</p></blockquote><p>而后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit –m <span class="string">&quot;add branch&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p>这样就上传完了，可以去你的github上看一看hexo分支有没有上传上去，其中node_modules、public、db.json已经被忽略掉了，没有关系，不需要上传的，因为在别的电脑上需要重新输入命令安装 。</p><h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><h2 id="设置git全局邮箱和用户名"><a href="#设置git全局邮箱和用户名" class="headerlink" title="设置git全局邮箱和用户名"></a>设置git全局邮箱和用户名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;yourgithubname&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;yourgithubemail&quot;</span></span><br></pre></td></tr></table></figure><h2 id="设置ssh-key"><a href="#设置ssh-key" class="headerlink" title="设置ssh key"></a>设置ssh key</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;youremail&quot;</span></span><br></pre></td></tr></table></figure><p>​    生成后填到github和coding上（有coding平台的话）<br>​    验证是否成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -T git@git.coding.net <span class="comment">#(有coding平台的话)</span></span><br></pre></td></tr></table></figure><h2 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br><span class="line">sudo apt-get install npm</span><br></pre></td></tr></table></figure><h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install hexo-cli -g </span><br></pre></td></tr></table></figure><p>但是已经不需要初始化了，<br>直接在任意文件夹下，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@………………</span><br></pre></td></tr></table></figure><p>然后进入克隆到的文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> xxx.github.io</span><br><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>生成，部署：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>然后就可以开始写你的新博客了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new newpage</span><br></pre></td></tr></table></figure><p>每次写完最好都把源文件上传一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit –m <span class="string">&quot;xxxx&quot;</span></span><br><span class="line">git push </span><br></pre></td></tr></table></figure><p>如果是在已经编辑过的电脑上，已经有clone文件夹了，那么，每次只要和远端同步一下就行了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 8 安装 Mysql 5.7</title>
      <link href="/2021/06/17/CentOS%208%20%E5%AE%89%E8%A3%85Mysql%205.7/"/>
      <url>/2021/06/17/CentOS%208%20%E5%AE%89%E8%A3%85Mysql%205.7/</url>
      
        <content type="html"><![CDATA[<p>在Centos8上用原来Centos7上安装MySQL5.7的方法会安装失败，显示mysql-community-server安装错误。我们用新的方法在Centos8上安装MySQL5.7</p><h1 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h1><h2 id="添加MySQL存储库"><a href="#添加MySQL存储库" class="headerlink" title="添加MySQL存储库"></a>添加MySQL存储库</h2><p>禁用MySQL默认的AppStream存储库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf remove @mysql</span><br><span class="line">sudo dnf module reset mysql &amp;&amp; sudo dnf module disable mysql</span><br></pre></td></tr></table></figure><p>centos8没有MySQL存储库，因此我们将使用centos 7存储库。创建一个新的存储库文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/yum.repos.d/mysql-community.repo</span><br></pre></td></tr></table></figure><p>将以下数据插入上面的存储库中</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[mysql57-community]</span><br><span class="line">name=MySQL <span class="number">5.7</span> Community Server</span><br><span class="line">baseurl=http:<span class="comment">//repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[mysql-connectors-community]</span><br><span class="line">name=MySQL Connectors Community</span><br><span class="line">baseurl=http:<span class="comment">//repo.mysql.com/yum/mysql-connectors-community/el/7/$basearch/</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[mysql-tools-community]</span><br><span class="line">name=MySQL Tools Community</span><br><span class="line">baseurl=http:<span class="comment">//repo.mysql.com/yum/mysql-tools-community/el/7/$basearch/</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="安装MySQL-这里我选择MySQL5-7"><a href="#安装MySQL-这里我选择MySQL5-7" class="headerlink" title="安装MySQL(这里我选择MySQL5.7)"></a>安装MySQL(这里我选择MySQL5.7)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf --enablerepo=mysql57-community install mysql-community-server</span><br></pre></td></tr></table></figure><p>如果安装失败,使用以下方法进行安装</p><p>先下载rpm包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-common-5.7.27-1.el6.x86_64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-libs-5.7.27-1.el6.x86_64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-client-5.7.27-1.el6.x86_64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-server-5.7.27-1.el6.x86_64.rpm</span><br></pre></td></tr></table></figure><p>再安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mysql-community-common-5.7.27-1.el6.x86_64.rpm</span><br><span class="line">yum install -y mysql-community-libs-5.7.27-1.el6.x86_64.rpm</span><br><span class="line">yum install -y mysql-community-client-5.7.27-1.el6.x86_64.rpm</span><br><span class="line">yum install -y mysql-community-server-5.7.27-1.el6.x86_64.rpm</span><br></pre></td></tr></table></figure><h2 id="下载完成后检查版本"><a href="#下载完成后检查版本" class="headerlink" title="下载完成后检查版本"></a>下载完成后检查版本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# rpm -qi mysql-community-server</span><br><span class="line">Name        : mysql-community-server</span><br><span class="line">Version     : 5.7.34</span><br><span class="line">Release     : 1.el7</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: Thu 27 May 2021 02:23:15 PM CST</span><br><span class="line">Group       : Applications/Databases</span><br><span class="line">Size        : 797908158</span><br><span class="line">License     : Copyright (c) 2000, 2021, Oracle and/or its affiliates. All rights reserved. Under GPLv2 license as shown in the Description field.</span><br><span class="line">Signature   : DSA/SHA1, Sat 27 Mar 2021 12:49:59 AM CST, Key ID 8c718d3b5072e1f5</span><br><span class="line">Source RPM  : mysql-community-5.7.34-1.el7.src.rpm</span><br><span class="line">Build Date  : Fri 26 Mar 2021 03:24:41 PM CST</span><br><span class="line">Build Host  : pb2-el7-07.appad3iad.mysql2iad.oraclevcn.com</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : MySQL Release Engineering &lt;mysql-build@oss.oracle.com&gt;</span><br><span class="line">Vendor      : Oracle and/or its affiliates</span><br><span class="line">URL         : http://www.mysql.com/</span><br><span class="line">Summary     : A very fast and reliable SQL database server</span><br><span class="line">Description :</span><br><span class="line">The MySQL(TM) software delivers a very fast, multi-threaded, multi-user,</span><br><span class="line">and robust SQL (Structured Query Language) database server. MySQL Server</span><br><span class="line">is intended for mission-critical, heavy-load production systems as well</span><br><span class="line">as for embedding into mass-deployed software. MySQL is a trademark of</span><br><span class="line">Oracle and/or its affiliates</span><br><span class="line"></span><br><span class="line">The MySQL software has Dual Licensing, which means you can use the MySQL</span><br><span class="line">software free of charge under the GNU General Public License</span><br><span class="line">(http://www.gnu.org/licenses/). You can also purchase commercial MySQL</span><br><span class="line">licenses from Oracle and/or its affiliates if you do not wish to be bound by the terms of</span><br><span class="line">the GPL. See the chapter &quot;Licensing and Support&quot; in the manual for</span><br><span class="line">further info.</span><br><span class="line"></span><br><span class="line">The MySQL web site (http://www.mysql.com/) provides the latest news and</span><br><span class="line">information about the MySQL software.  Also please see the documentation</span><br><span class="line">and the manual for more information.</span><br><span class="line"></span><br><span class="line">This package includes the MySQL server binary as well as related utilities</span><br><span class="line">to run and administer a MySQL server.</span><br></pre></td></tr></table></figure><p>出现以上信息说明安装成功</p><h2 id="检查-mysql-源是否安装成功"><a href="#检查-mysql-源是否安装成功" class="headerlink" title="检查 mysql 源是否安装成功"></a>检查 mysql 源是否安装成功</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br></pre></td></tr></table></figure><p>出现以下信息说明安装成功：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql-connectors-community MySQL Connectors Community                       141</span><br><span class="line">mysql-tools-community      MySQL Tools Community                            105</span><br><span class="line">mysql57-community          MySQL 5.7 Community Server</span><br></pre></td></tr></table></figure><p>如果遇到版本不对，现象是客户端版本比较低，则需要执行更新操作：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf update mysql</span><br></pre></td></tr></table></figure><h2 id="启动MySQL"><a href="#启动MySQL" class="headerlink" title="启动MySQL"></a>启动MySQL</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure><h2 id="查看启动状态"><a href="#查看启动状态" class="headerlink" title="查看启动状态"></a>查看启动状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure><p>出现以下信息，则启动成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# systemctl status mysqld</span><br><span class="line">● mysqld.service - MySQL Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) (thawing) since Thu 2021-05-27 14:35:11 CST; 4min 6s ago</span><br><span class="line">     Docs: man:mysqld(8)</span><br><span class="line">           http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">  Process: 13463 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 13445 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 13466 (mysqld)</span><br><span class="line">    Tasks: 29 (limit: 4752)</span><br><span class="line">   Memory: 218.1M</span><br><span class="line">   CGroup: /system.slice/mysqld.service</span><br><span class="line">           └─13466 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"></span><br><span class="line">May 27 14:35:10 node1 systemd[1]: mysqld.service: Succeeded.</span><br><span class="line">May 27 14:35:10 node1 systemd[1]: Stopped MySQL Server.</span><br><span class="line">May 27 14:35:10 node1 systemd[1]: Starting MySQL Server...</span><br><span class="line">May 27 14:35:11 node1 systemd[1]: Started MySQL Server.</span><br></pre></td></tr></table></figure><h2 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable mysqld</span><br></pre></td></tr></table></figure><h2 id="刷新所有修改过的配置文件"><a href="#刷新所有修改过的配置文件" class="headerlink" title="刷新所有修改过的配置文件"></a>刷新所有修改过的配置文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><h2 id="获取安装mysql后生成的临时密码，用于登录"><a href="#获取安装mysql后生成的临时密码，用于登录" class="headerlink" title="获取安装mysql后生成的临时密码，用于登录"></a>获取安装mysql后生成的临时密码，用于登录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br></pre></td></tr></table></figure><p># 如果出现如下列信息，密码为: <strong>Ldse65Csow#g</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2021-05-27T06:25:51.106817Z 1 [Note] A temporary password is generated for root@localhost: Ldse65Csow#g</span><br></pre></td></tr></table></figure><h2 id="登录MySQL"><a href="#登录MySQL" class="headerlink" title="登录MySQL"></a>登录MySQL</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p Ldse65Csow#g</span><br></pre></td></tr></table></figure><p># 再输入上面查找得到的临时密码即可进入mysql</p><h2 id="修改登录密码"><a href="#修改登录密码" class="headerlink" title="修改登录密码"></a>修改登录密码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set global validate_password_policy=0;</span><br><span class="line">set global validate_password_length=1;</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><h3 id="添加远程登录用户-即本机访问服务器上的MySQL"><a href="#添加远程登录用户-即本机访问服务器上的MySQL" class="headerlink" title="添加远程登录用户(即本机访问服务器上的MySQL)"></a>添加远程登录用户(即本机访问服务器上的MySQL)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO &#x27;zhangsan（用户名）&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;Zhangsan2018!（密码）&#x27; WITH GRANT OPTION;</span><br><span class="line"># 或者直接将root权限修改为可以通过远程访问(但不推荐)</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; UPDATE user SET Host=&#x27;%&#x27; WHERE User=&#x27;root&#x27;;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><h2 id="设置默认编码为utf-8（mysql安装后默认不支持中文）"><a href="#设置默认编码为utf-8（mysql安装后默认不支持中文）" class="headerlink" title="设置默认编码为utf-8（mysql安装后默认不支持中文）"></a>设置默认编码为utf-8（mysql安装后默认不支持中文）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入文件后添加下面的配置即可</span></span><br><span class="line">[mysqld]</span><br><span class="line">character-set-server=utf8</span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure><h2 id="重启MySQL服务并进入MySQL"><a href="#重启MySQL服务并进入MySQL" class="headerlink" title="重启MySQL服务并进入MySQL"></a>重启MySQL服务并进入MySQL</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> systemctl restart mysqld</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> mysql -uroot -p</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show variables like <span class="string">&#x27;character%&#x27;</span>;</span></span><br></pre></td></tr></table></figure><p>出现如下则说明编码修改完成</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;character%&#x27;;</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | utf8                       |</span><br><span class="line">| character_set_connection | utf8                       |</span><br><span class="line">| character_set_database   | utf8                       |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | utf8                       |</span><br><span class="line">| character_set_server     | utf8                       |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="退出MySQL"><a href="#退出MySQL" class="headerlink" title="退出MySQL"></a>退出MySQL</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure><p>使用本机电脑navicat/sqlyog等一系列客户端工具连接服务器上的mysql，用户名和密码为远程用户的用户名和密码，如果是将root权限修改为可以远程访问，就用root访问。</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS8 安装</title>
      <link href="/2021/06/16/centOS8install/"/>
      <url>/2021/06/16/centOS8install/</url>
      
        <content type="html"><![CDATA[<h2 id="系统最小化安装"><a href="#系统最小化安装" class="headerlink" title="系统最小化安装"></a>系统最小化安装</h2><p><img src="/2021/06/16/centOS8install/image-20210526170136155.png" alt="image-20210526170136155"></p><p><img src="/2021/06/16/centOS8install/image-20210526170151325.png" alt="image-20210526170151325"></p><p>​                                                            <img src="/2021/06/16/centOS8install/image-20210526170202591.png" alt="image-20210526170202591"></p><p>​                    此处没有<strong>CentOS 8</strong>可以选择<strong>CentOS 7</strong></p><p><img src="/2021/06/16/centOS8install/image-20210526170220072.png" alt="image-20210526170220072"></p><p><img src="/2021/06/16/centOS8install/image-20210526170348489.png" alt="image-20210526170348489"></p><p><img src="/2021/06/16/centOS8install/image-20210526170403991.png" alt="image-20210526170403991"></p><p>内存不要小于<strong>768M</strong>，否者会安装失败</p><p><img src="/2021/06/16/centOS8install/image-20210526170417417.png" alt="image-20210526170417417"></p><p>本地使用就选择NAT模式，让其他人访问选择桥接</p><p><img src="/2021/06/16/centOS8install/image-20210526170452656.png" alt="image-20210526170452656"></p><p><img src="/2021/06/16/centOS8install/image-20210526170530514.png" alt="image-20210526170530514"></p><p><img src="/2021/06/16/centOS8install/image-20210526170538167-1622019938520.png" alt="image-20210526170538167"></p><p><img src="/2021/06/16/centOS8install/image-20210526170547533.png" alt="image-20210526170547533"></p><p>最大大小可以往大了调，占用大小是实际用量。设置小了以后扩展麻烦</p><p><img src="/2021/06/16/centOS8install/image-20210526170559677.png" alt="image-20210526170559677"></p><p><img src="/2021/06/16/centOS8install/image-20210526170705247.png" alt="image-20210526170705247"></p><p>完成！</p><p><img src="/2021/06/16/centOS8install/image-20210526170715276.png" alt="image-20210526170715276"></p><p><img src="/2021/06/16/centOS8install/image-20210526170803102.png" alt="image-20210526170803102"></p><p><img src="/2021/06/16/centOS8install/image-20210526170828415.png" alt="image-20210526170828415"></p><p>开机</p><p><img src="/2021/06/16/centOS8install/image-20210526171625947.png" alt="image-20210526171625947"></p><p><img src="/2021/06/16/centOS8install/image-20210526171645830.png" alt="image-20210526171645830"></p><p>下面这几个位置需要设置一下：</p><p><img src="/2021/06/16/centOS8install/image-20210526171709347.png" alt="image-20210526171709347"></p><p>首先设置安装目的地：</p><p><img src="/2021/06/16/centOS8install/image-20210526171737210-1622020657737.png" alt="image-20210526171737210"></p><p>设置时间和日期：</p><p><img src="/2021/06/16/centOS8install/image-20210526171754252.png" alt="image-20210526171754252"></p><p>设置网络和主机名（打开网络，默认是关着的）</p><p><img src="/2021/06/16/centOS8install/image-20210526171812504.png" alt="image-20210526171812504"></p><p>选择安装的软件（最小安装即可）：</p><p><img src="/2021/06/16/centOS8install/image-20210526171827942.png" alt="image-20210526171827942"></p><p>最后设置下root密码</p><p>123456</p><p><img src="/2021/06/16/centOS8install/image-20210526171910790.png" alt="image-20210526171910790"></p><p>由于密码太简单，我们需要点两次完成。</p><p>安装</p><p><img src="/2021/06/16/centOS8install/image-20210526171943437.png" alt="image-20210526171943437"></p><p>配置完成，点击重启：</p><p><img src="/2021/06/16/centOS8install/image-20210526172000683.png" alt="image-20210526172000683"></p><p>遇到下面这里不用管（也可以按回车快速跳过）：</p><p><img src="/2021/06/16/centOS8install/image-20210526172018216.png" alt="image-20210526172018216"></p><p>登录输入用户名和密码：root/123456 即可</p><p><img src="/2021/06/16/centOS8install/image-20210526172412351.png" alt="image-20210526172412351"></p><h2 id="配置IP"><a href="#配置IP" class="headerlink" title="配置IP"></a>配置IP</h2><p>–VM:编辑&gt;虚拟网络编辑器</p><img src="/2021/06/16/centOS8install/image-20210526172852231.png" alt="image-20210526172852231"><p><img src="/2021/06/16/centOS8install/image-20210526173106603.png" alt="image-20210526173106603"></p><p><img src="/2021/06/16/centOS8install/image-20210526173127973.png" alt="image-20210526173127973"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure><p><img src="/2021/06/16/centOS8install/image-20210526173431297.png" alt="image-20210526173431297"></p><p>•删除UUID和MAC地址</p><blockquote><p>TYPE=Ethernet<br>PROXY_METHOD=none<br>BROWSER_ONLY=no<br>BOOTPROTO=static<br>DEFROUTE=yes<br>IPV4_FAILURE_FATAL=no<br>IPV6INIT=yes<br>IPV6_AUTOCONF=yes<br>IPV6_DEFROUTE=yes<br>IPV6_FAILURE_FATAL=no<br>IPV6_ADDR_GEN_MODE=stable-privacy<br>NAME=ens33<br>DEVICE=ens33<br>ONBOOT=yes<br>IPADDR=192.168.163.100<br>NETMASK=255.255.255.0<br>GATEWAY=192.168.163.2<br>DNS1=114.114.114.114<br>PREFIX=24</p></blockquote><p>修改完IPADDR的IP和Gateway的网段保存</p><p>输入nmcli c reload 重启网卡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli c reload</span><br></pre></td></tr></table></figure><p>输入nmcli c up ens33启用ens33网卡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli c up ens33</span><br></pre></td></tr></table></figure><p><img src="/2021/06/16/centOS8install/image-20210527092325900.png" alt="image-20210527092325900"></p><h2 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h2><blockquote><ol><li>查看防火墙状态</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld.service</span><br></pre></td></tr></table></figure><p><img src="/2021/06/16/centOS8install/image-20210527102952085.png" alt="image-20210527102952085"></p><ol start="2"><li>开启防火墙</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld.service</span><br></pre></td></tr></table></figure><ol start="3"><li>关闭防火墙</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure><ol start="4"><li>禁用防火墙</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure></blockquote><h2 id="更改主机名"><a href="#更改主机名" class="headerlink" title="更改主机名"></a>更改主机名</h2><ol><li><p>使用hostnamectl命令</p><p>在CentOS 8和所有其他使用systemd的Linux发行版中，你可以使用hostnamectl命令更改系统主机名和相关设置，语法如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname name [option...]</span><br></pre></td></tr></table></figure><p>其中 <em>option</em> 是 <code>--pretty</code>、<code>--static</code>, 会 <code>--transient</code> 中的一个或多个选项。</p><p>如果 <code>--static</code> 或 <code>--transient</code> 选项与 <code>--pretty</code> 选项一同使用，则会将 static 和 transient 主机名简化为 pretty 主机名格式。使用 “<code>-</code>” 替换空格，并删除特殊字符。如果未使用 <code>--pretty</code> 选项，则不会发生简化。</p><p>例如，要将系统静态主机名更改为node0，可以使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname node0</span><br></pre></td></tr></table></figure><p>要验证主机名是否已成功更改，请使用hostnamectl命令。</p></li><li><p>使用nmcli命令</p><p>nmcli是用于控制NetworkManager的命令行工具，也可用于更改系统的主机名。</p><blockquote><p>要查看当前主机名，请输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli g hostname</span><br></pre></td></tr></table></figure><p>要将主机名更改为node0，请使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli g hostname node0</span><br></pre></td></tr></table></figure><p>为了使更改生效，请重新启动systemd-hostnamed服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart systemd-hostnamed</span><br></pre></td></tr></table></figure></blockquote></li></ol><h2 id="关机"><a href="#关机" class="headerlink" title="关机"></a>关机</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poweroff</span><br></pre></td></tr></table></figure><h2 id="创建快照"><a href="#创建快照" class="headerlink" title="创建快照"></a>创建快照</h2><p><img src="/2021/06/16/centOS8install/image-20210527110945130.png" alt="image-20210527110945130"></p><h2 id="克隆"><a href="#克隆" class="headerlink" title="克隆"></a>克隆</h2><ol><li>克隆虚拟机</li></ol><p><img src="/2021/06/16/centOS8install/image-20210527111005574.png" alt="image-20210527111005574"></p><p><img src="/2021/06/16/centOS8install/image-20210527111015964.png" alt="image-20210527111015964"></p><p><img src="/2021/06/16/centOS8install/image-20210527111035983.png" alt="image-20210527111035983"></p><ol start="2"><li>更改ip</li><li>更改主机名</li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
